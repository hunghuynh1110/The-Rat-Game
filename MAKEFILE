# CSSE2310 A4 Makefile â€” clean & mark-safe

CC       = gcc
CFLAGS   = -Wall -Wextra -pedantic -std=gnu99 -pthread -MMD -MP
MOSS_LIB = /local/courses/csse2310/lib

# Server-only link flags & libs
LDFLAGS_ratsserver = -L$(MOSS_LIB) -Wl,-rpath,$(MOSS_LIB)
LDLIBS_ratsserver  = -lcsse2310a4

OBJS_CLIENT = ratsclient.o protocol.o
OBJS_SERVER = ratsserver.o protocol.o

.PHONY: all clean
all: ratsclient ratsserver

ratsclient: $(OBJS_CLIENT)
	$(CC) $(CFLAGS) -o $@ $(OBJS_CLIENT)

ratsserver: $(OBJS_SERVER)
	$(CC) $(CFLAGS) $(LDFLAGS_ratsserver) -o $@ $(OBJS_SERVER) $(LDLIBS_ratsserver)

# Generic compile rule (emits .o and a matching .d for deps)
%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# Auto-include dependency files (safe if they don't exist yet)
-include $(OBJS_CLIENT:.o=.d) $(OBJS_SERVER:.o=.d)

clean:
	rm -f *.o *.d ratsclient ratsserver